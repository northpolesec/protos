/// Copyright 2025 North Pole Security, Inc.
///
/// Licensed under the Apache License, Version 2.0 (the "License");
/// you may not use this file except in compliance with the License.
/// You may obtain a copy of the License at
///
///     http://www.apache.org/licenses/LICENSE-2.0
///
/// Unless required by applicable law or agreed to in writing, software
/// distributed under the License is distributed on an "AS IS" BASIS,
/// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
/// See the License for the specific language governing permissions and
/// limitations under the License.

syntax = "proto3";

package santa.commands.v1;

option go_package = "buf.build/gen/go/northpolesec/protos/protocolbuffers/go/commands";

message RunningProcess {
  int32 pid = 1;
  int32 pidversion = 2;
  string boot_session_uuid = 3 [json_name = "boot_session_uuid"];
}

message KillRequest {
  oneof process {
    RunningProcess running_process = 1 [json_name = "running_process"];
    string cdhash = 2;
    string signing_id = 3 [json_name = "signing_id"];
    string team_id = 4 [json_name = "team_id"];
  }
}

message KillResponse {
  enum Error {
    ERROR_UNSPECIFIED = 0;
    ERROR_INTERNAL = 1;
    ERROR_UNKNOWN_PROCESS_TYPE = 2;
    ERROR_INVALID_RUNNING_PROCESS = 3;
    ERROR_INVALID_CDHASH = 4;
    ERROR_INVALID_SIGNING_ID = 5;
    ERROR_INVALID_TEAM_ID = 6;
    ERROR_LIST_PIDS = 7;
    ERROR_TIMEOUT = 8;
  }

  enum KillError {
    KILL_ERROR_UNSPECIFIED = 0;
    KILL_ERROR_INTERNAL = 1;
    KILL_ERROR_OPERATION_NOT_PERMITTED = 2;
    KILL_ERROR_NO_SUCH_PROCESS = 3;
    KILL_ERROR_INVALID_ARGUMENT = 4;
    KILL_ERROR_INVALID_TARGET = 5;
    KILL_ERROR_BOOT_SESSION_MISMATCH = 6;
  }

  message Process {
    int32 pid = 1;
    int32 pidversion = 2;
    optional KillError error = 3;
  }

  optional Error error = 1;
  repeated Process processes = 2;
}

// Command message sent to santa.host.<deviceid>.commands
message SantaCommandRequest {
  string uuid = 1;

  oneof command {
    PingRequest ping = 10;
    KillRequest kill = 11;
  }
}

message SantaCommandResponse {
  enum Error {
    ERROR_UNSPECIFIED = 0;
    ERROR_INVALID_DATA = 1;
    ERROR_DESERIALIZATION = 2;
    ERROR_INVALID_UUID = 3;
    ERROR_UNKNOWN_REQUEST_TYPE = 4;
  }

  optional Error error = 1;

  oneof result {
    PingResponse ping = 2;
    KillResponse kill = 3;
  }
}

// An empty message just to send request a ping
message PingRequest {}

// An empty message just to respond
message PingResponse {}
